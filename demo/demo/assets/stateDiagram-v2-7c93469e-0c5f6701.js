var X=Object.defineProperty;var l=(t,n)=>X(t,"name",{value:n,configurable:!0});import{p as Z,d as B,s as j,D as H,a as F,S as I,b as tt,c as et}from"./styles-f626f8de-581d5f89.js";import{G as ot}from"./layout-06a9841d.js";import{l as a,c as $,i as C,z as st,j as nt,k as G}from"./mermaid-a98f434b-6ad3a326.js";import{r as it}from"./index-4c4adb72-f5a5e4b7.js";import"./get-fec7d053.js";import"./isArray-6de4a062.js";import"./isSymbol-3167caec.js";import"./memoize-a38ec700.js";import"./_MapCache-7e836c94.js";import"./toString-40b958f3.js";import"./_getTag-9b3eabd6.js";import"./now-f5237b2a.js";import"./_arrayReduce-b962fc90.js";import"./preload-helper-d51aff73.js";import"./index-32ac9e7b.js";import"./_commonjsHelpers-df0bf62c.js";import"./edges-b00f0ec2-afddb99d.js";import"./createText-285e50b4-c51484b0.js";import"./svgDraw-5d8a058e-478ed659.js";import"./line-b92a72a5.js";import"./array-2d8cd92e.js";import"./path-56a6d420.js";const y="rect",R="rectWithTitle",ct="start",rt="end",lt="divider",at="roundedWithTitle",dt="note",Et="noteGroup",u="statediagram",pt="state",St=`${u}-${pt}`,U="transition",Tt="note",_t="note-edge",ut=`${U} ${_t}`,Dt=`${u}-${Tt}`,ft="cluster",bt=`${u}-${ft}`,At="cluster-alt",ht=`${u}-${At}`,V="parent",Y="note",yt="state",L="----",gt=`${L}${Y}`,M=`${L}${V}`,z="fill:none",W="fill: #333",q="c",K="text",J="normal";let g={},p=0;const $t=l(function(t){const n=Object.keys(t);for(const e of n)t[e]},"setConf"),xt=l(function(t,n){a.trace("Extracting classes"),n.db.clear();try{return n.parser.parse(t),n.db.extract(n.db.getRootDocV2()),n.db.getClasses()}catch(e){return e}},"getClasses");function Ct(t){return t==null?"":t.classes?t.classes.join(" "):""}l(Ct,"getClassesFromDbInfo");function w(t="",n=0,e="",i=L){const c=e!==null&&e.length>0?`${i}${e}`:"";return`${yt}-${t}${c}-${n}`}l(w,"stateDomId");const h=l((t,n,e,i,c,r)=>{const o=e.id,D=Ct(i[o]);if(o!=="root"){let T=y;e.start===!0&&(T=ct),e.start===!1&&(T=rt),e.type!==H&&(T=e.type),g[o]||(g[o]={id:o,shape:T,description:G.sanitizeText(o,$()),classes:`${D} ${St}`});const s=g[o];e.description&&(Array.isArray(s.description)?(s.shape=R,s.description.push(e.description)):s.description.length>0?(s.shape=R,s.description===o?s.description=[e.description]:s.description=[s.description,e.description]):(s.shape=y,s.description=e.description),s.description=G.sanitizeTextOrArray(s.description,$())),s.description.length===1&&s.shape===R&&(s.shape=y),!s.type&&e.doc&&(a.info("Setting cluster for ",o,N(e)),s.type="group",s.dir=N(e),s.shape=e.type===F?lt:at,s.classes=s.classes+" "+bt+" "+(r?ht:""));const _={labelStyle:"",shape:s.shape,labelText:s.description,classes:s.classes,style:"",id:o,dir:s.dir,domId:w(o,p),type:s.type,padding:15};if(_.centerLabel=!0,e.note){const d={labelStyle:"",shape:dt,labelText:e.note.text,classes:Dt,style:"",id:o+gt+"-"+p,domId:w(o,p,Y),type:s.type,padding:15},E={labelStyle:"",shape:Et,labelText:e.note.text,classes:s.classes,style:"",id:o+M,domId:w(o,p,V),type:"group",padding:0};p++;const f=o+M;t.setNode(f,E),t.setNode(d.id,d),t.setNode(o,_),t.setParent(o,f),t.setParent(d.id,f);let S=o,b=d.id;e.note.position==="left of"&&(S=d.id,b=o),t.setEdge(S,b,{arrowhead:"none",arrowType:"",style:z,labelStyle:"",classes:ut,arrowheadStyle:W,labelpos:q,labelType:K,thickness:J})}else t.setNode(o,_)}n&&n.id!=="root"&&(a.trace("Setting node ",o," to be child of its parent ",n.id),t.setParent(o,n.id)),e.doc&&(a.trace("Adding nodes children "),Rt(t,e,e.doc,i,c,!r))},"setupNode"),Rt=l((t,n,e,i,c,r)=>{a.trace("items",e),e.forEach(o=>{switch(o.stmt){case tt:h(t,n,o,i,c,r);break;case H:h(t,n,o,i,c,r);break;case I:{h(t,n,o.state1,i,c,r),h(t,n,o.state2,i,c,r);const D={id:"edge"+p,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:z,labelStyle:"",label:G.sanitizeText(o.description,$()),arrowheadStyle:W,labelpos:q,labelType:K,thickness:J,classes:U};t.setEdge(o.state1.id,o.state2.id,D,p),p++}break}})},"setupDoc"),N=l((t,n=et)=>{let e=n;if(t.doc)for(let i=0;i<t.doc.length;i++){const c=t.doc[i];c.stmt==="dir"&&(e=c.value)}return e},"getDir"),wt=l(async function(t,n,e,i){a.info("Drawing state diagram (v2)",n),g={},i.db.getDirection();const{securityLevel:c,state:r}=$(),o=r.nodeSpacing||50,D=r.rankSpacing||50;a.info(i.db.getRootDocV2()),i.db.extract(i.db.getRootDocV2()),a.info(i.db.getRootDocV2());const T=i.db.getStates(),s=new ot({multigraph:!0,compound:!0}).setGraph({rankdir:N(i.db.getRootDocV2()),nodesep:o,ranksep:D,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});h(s,void 0,i.db.getRootDocV2(),T,i.db,!0);let _;c==="sandbox"&&(_=C("#i"+n));const d=c==="sandbox"?C(_.nodes()[0].contentDocument.body):C("body"),E=d.select(`[id="${n}"]`),f=d.select("#"+n+" g");await it(f,s,["barb"],u,n);const S=8;st.insertTitle(E,"statediagramTitleText",r.titleTopMargin,i.db.getDiagramTitle());const b=E.node().getBBox(),P=b.width+S*2,k=b.height+S*2;E.attr("class",u);const v=E.node().getBBox();nt(E,k,P,r.useMaxWidth);const O=`${v.x-S} ${v.y-S} ${P} ${k}`;a.debug(`viewBox ${O}`),E.attr("viewBox",O);const Q=document.querySelectorAll('[id="'+n+'"] .edgeLabel .label');for(const x of Q){const m=x.getBBox(),A=document.createElementNS("http://www.w3.org/2000/svg",y);A.setAttribute("rx",0),A.setAttribute("ry",0),A.setAttribute("width",m.width),A.setAttribute("height",m.height),x.insertBefore(A,x.firstChild)}},"draw"),Gt={setConf:$t,getClasses:xt,draw:wt},It={parser:Z,db:B,renderer:Gt,styles:j,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,B.clear()}};export{It as diagram};
//# sourceMappingURL=stateDiagram-v2-7c93469e-0c5f6701.js.map
