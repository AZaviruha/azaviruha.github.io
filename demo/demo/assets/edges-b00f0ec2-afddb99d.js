var st=Object.defineProperty;var d=(r,t)=>st(r,"name",{value:t,configurable:!0});import{r as $,c as m,d as F,G as z,i as E,l as g,z as A,H as Q}from"./mermaid-a98f434b-6ad3a326.js";import{c as tt}from"./createText-285e50b4-c51484b0.js";import{p as V}from"./svgDraw-5d8a058e-478ed659.js";import{l as it}from"./line-b92a72a5.js";const nt=d((r,t,e,n)=>{t.forEach(a=>{xt[a](r,e,n)})},"insertMarkers"),lt=d((r,t,e)=>{g.trace("Making markers for ",e),r.append("defs").append("marker").attr("id",t+"-extensionStart").attr("class","marker extension "+t).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),r.append("defs").append("marker").attr("id",t+"-extensionEnd").attr("class","marker extension "+t).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},"extension"),ct=d((r,t)=>{r.append("defs").append("marker").attr("id",t+"-compositionStart").attr("class","marker composition "+t).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",t+"-compositionEnd").attr("class","marker composition "+t).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"composition"),ht=d((r,t)=>{r.append("defs").append("marker").attr("id",t+"-aggregationStart").attr("class","marker aggregation "+t).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",t+"-aggregationEnd").attr("class","marker aggregation "+t).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"aggregation"),ot=d((r,t)=>{r.append("defs").append("marker").attr("id",t+"-dependencyStart").attr("class","marker dependency "+t).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",t+"-dependencyEnd").attr("class","marker dependency "+t).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},"dependency"),ft=d((r,t)=>{r.append("defs").append("marker").attr("id",t+"-lollipopStart").attr("class","marker lollipop "+t).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","white").attr("cx",6).attr("cy",7).attr("r",6)},"lollipop"),dt=d((r,t)=>{r.append("marker").attr("id",t+"-pointEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),r.append("marker").attr("id",t+"-pointStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",0).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"point"),pt=d((r,t)=>{r.append("marker").attr("id",t+"-circleEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),r.append("marker").attr("id",t+"-circleStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"circle$1"),yt=d((r,t)=>{r.append("marker").attr("id",t+"-crossEnd").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),r.append("marker").attr("id",t+"-crossStart").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},"cross"),bt=d((r,t)=>{r.append("defs").append("marker").attr("id",t+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","strokeWidth").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"barb"),xt={extension:lt,composition:ct,aggregation:ht,dependency:ot,lollipop:ft,point:dt,circle:pt,cross:yt,barb:bt},tr=nt;function gt(r,t){t&&r.attr("style",t)}d(gt,"applyStyle");function ut(r){const t=E(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")),e=t.append("xhtml:div"),n=r.label,a=r.isNode?"nodeLabel":"edgeLabel";return e.html('<span class="'+a+'" '+(r.labelStyle?'style="'+r.labelStyle+'"':"")+">"+n+"</span>"),gt(e,r.labelStyle),e.style("display","inline-block"),e.style("white-space","nowrap"),e.attr("xmlns","http://www.w3.org/1999/xhtml"),t.node()}d(ut,"addHtmlLabel");const wt=d((r,t,e,n)=>{let a=r||"";if(typeof a=="object"&&(a=a[0]),$(m().flowchart.htmlLabels)){a=a.replace(/\\n|\n/g,"<br />"),g.info("vertexText"+a);const s={isNode:n,label:z(a).replace(/fa[blrs]?:fa-[\w-]+/g,l=>`<i class='${l.replace(":"," ")}'></i>`),labelStyle:t.replace("fill:","color:")};return ut(s)}else{const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("style",t.replace("color:","fill:"));let i=[];typeof a=="string"?i=a.split(/\\n|\n|<br\s*\/?>/gi):Array.isArray(a)?i=a:i=[];for(const l of i){const c=document.createElementNS("http://www.w3.org/2000/svg","tspan");c.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),c.setAttribute("dy","1em"),c.setAttribute("x","0"),e?c.setAttribute("class","title-row"):c.setAttribute("class","row"),c.textContent=l.trim(),s.appendChild(c)}return s}},"createLabel"),I=wt,M=d(async(r,t,e,n)=>{let a;const s=t.useHtmlLabels||$(m().flowchart.htmlLabels);e?a=e:a="node default";const i=r.insert("g").attr("class",a).attr("id",t.domId||t.id),l=i.insert("g").attr("class","label").attr("style",t.labelStyle);let c;t.labelText===void 0?c="":c=typeof t.labelText=="string"?t.labelText:t.labelText[0];const o=l.node();let h;t.labelType==="markdown"?h=tt(l,F(z(c),m()),{useHtmlLabels:s,width:t.width||m().flowchart.wrappingWidth,classes:"markdown-node-label"}):h=o.appendChild(I(F(z(c),m()),t.labelStyle,!1,n));let f=h.getBBox();const x=t.padding/2;if($(m().flowchart.htmlLabels)){const p=h.children[0],y=E(h),b=p.getElementsByTagName("img");if(b){const u=c.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...b].map(w=>new Promise(H=>{function R(){if(w.style.display="flex",w.style.flexDirection="column",u){const C=m().fontSize?m().fontSize:window.getComputedStyle(document.body).fontSize,W=5;w.style.width=parseInt(C,10)*W+"px"}else w.style.width="100%";H(w)}d(R,"setupImage"),setTimeout(()=>{w.complete&&R()}),w.addEventListener("error",R),w.addEventListener("load",R)})))}f=p.getBoundingClientRect(),y.attr("width",f.width),y.attr("height",f.height)}return s?l.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"):l.attr("transform","translate(0, "+-f.height/2+")"),t.centerLabel&&l.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"),l.insert("rect",":first-child"),{shapeSvg:i,bbox:f,halfPadding:x,label:l}},"labelHelper"),v=d((r,t)=>{const e=t.node().getBBox();r.width=e.width,r.height=e.height},"updateNodeBounds");function _(r,t,e,n){return r.insert("polygon",":first-child").attr("points",n.map(function(a){return a.x+","+a.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-t/2+","+e/2+")")}d(_,"insertPolygonShape");function mt(r,t){return r.intersect(t)}d(mt,"intersectNode");function rt(r,t,e,n){var a=r.x,s=r.y,i=a-n.x,l=s-n.y,c=Math.sqrt(t*t*l*l+e*e*i*i),o=Math.abs(t*e*i/c);n.x<a&&(o=-o);var h=Math.abs(t*e*l/c);return n.y<s&&(h=-h),{x:a+o,y:s+h}}d(rt,"intersectEllipse");function kt(r,t,e){return rt(r,t,t,e)}d(kt,"intersectCircle");function vt(r,t,e,n){var a,s,i,l,c,o,h,f,x,p,y,b,u,w,H;if(a=t.y-r.y,i=r.x-t.x,c=t.x*r.y-r.x*t.y,x=a*e.x+i*e.y+c,p=a*n.x+i*n.y+c,!(x!==0&&p!==0&&J(x,p))&&(s=n.y-e.y,l=e.x-n.x,o=n.x*e.y-e.x*n.y,h=s*r.x+l*r.y+o,f=s*t.x+l*t.y+o,!(h!==0&&f!==0&&J(h,f))&&(y=a*l-s*i,y!==0)))return b=Math.abs(y/2),u=i*o-l*c,w=u<0?(u-b)/y:(u+b)/y,u=s*c-a*o,H=u<0?(u-b)/y:(u+b)/y,{x:w,y:H}}d(vt,"intersectLine");function J(r,t){return r*t>0}d(J,"sameSign");function Lt(r,t,e){var n=r.x,a=r.y,s=[],i=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY;typeof t.forEach=="function"?t.forEach(function(y){i=Math.min(i,y.x),l=Math.min(l,y.y)}):(i=Math.min(i,t.x),l=Math.min(l,t.y));for(var c=n-r.width/2-i,o=a-r.height/2-l,h=0;h<t.length;h++){var f=t[h],x=t[h<t.length-1?h+1:0],p=vt(r,e,{x:c+f.x,y:o+f.y},{x:c+x.x,y:o+x.y});p&&s.push(p)}return s.length?(s.length>1&&s.sort(function(y,b){var u=y.x-e.x,w=y.y-e.y,H=Math.sqrt(u*u+w*w),R=b.x-e.x,C=b.y-e.y,W=Math.sqrt(R*R+C*C);return H<W?-1:H===W?0:1}),s[0]):r}d(Lt,"intersectPolygon");const St=d((r,t)=>{var e=r.x,n=r.y,a=t.x-e,s=t.y-n,i=r.width/2,l=r.height/2,c,o;return Math.abs(s)*i>Math.abs(a)*l?(s<0&&(l=-l),c=s===0?0:l*a/s,o=l):(a<0&&(i=-i),c=i,o=a===0?0:i*s/a),{x:e+c,y:n+o}},"intersectRect"),Bt=St,k={node:mt,circle:kt,ellipse:rt,polygon:Lt,rect:Bt},Et=d(async(r,t)=>{t.useHtmlLabels||m().flowchart.htmlLabels||(t.centerLabel=!0);const{shapeSvg:n,bbox:a,halfPadding:s}=await M(r,t,"node "+t.classes,!0);g.info("Classes = ",t.classes);const i=n.insert("rect",":first-child");return i.attr("rx",t.rx).attr("ry",t.ry).attr("x",-a.width/2-s).attr("y",-a.height/2-s).attr("width",a.width+t.padding).attr("height",a.height+t.padding),v(t,i),t.intersect=function(l){return k.rect(t,l)},n},"note"),Mt=Et,q=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=a+s,l=[{x:i/2,y:0},{x:i,y:-i/2},{x:i/2,y:-i},{x:0,y:-i/2}];g.info("Question main (Circle)");const c=_(e,i,i,l);return c.attr("style",t.style),v(t,c),t.intersect=function(o){return g.warn("Intersect called"),k.polygon(t,l,o)},e},"question"),Ct=d((r,t)=>{const e=r.insert("g").attr("class","node default").attr("id",t.domId||t.id),n=28,a=[{x:0,y:n/2},{x:n/2,y:0},{x:0,y:-n/2},{x:-n/2,y:0}];return e.insert("polygon",":first-child").attr("points",a.map(function(i){return i.x+","+i.y}).join(" ")).attr("class","state-start").attr("r",7).attr("width",28).attr("height",28),t.width=28,t.height=28,t.intersect=function(i){return k.circle(t,14,i)},e},"choice"),Tt=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=4,s=n.height+t.padding,i=s/a,l=n.width+2*i+t.padding,c=[{x:i,y:0},{x:l-i,y:0},{x:l,y:-s/2},{x:l-i,y:-s},{x:i,y:-s},{x:0,y:-s/2}],o=_(e,l,s,c);return o.attr("style",t.style),v(t,o),t.intersect=function(h){return k.polygon(t,c,h)},e},"hexagon"),Rt=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=[{x:-s/2,y:0},{x:a,y:0},{x:a,y:-s},{x:-s/2,y:-s},{x:0,y:-s/2}];return _(e,a,s,i).attr("style",t.style),t.width=a+s,t.height=s,t.intersect=function(c){return k.polygon(t,i,c)},e},"rect_left_inv_arrow"),It=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=[{x:-2*s/6,y:0},{x:a-s/6,y:0},{x:a+2*s/6,y:-s},{x:s/6,y:-s}],l=_(e,a,s,i);return l.attr("style",t.style),v(t,l),t.intersect=function(c){return k.polygon(t,i,c)},e},"lean_right"),Ht=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=[{x:2*s/6,y:0},{x:a+s/6,y:0},{x:a-2*s/6,y:-s},{x:-s/6,y:-s}],l=_(e,a,s,i);return l.attr("style",t.style),v(t,l),t.intersect=function(c){return k.polygon(t,i,c)},e},"lean_left"),$t=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=[{x:-2*s/6,y:0},{x:a+2*s/6,y:0},{x:a-s/6,y:-s},{x:s/6,y:-s}],l=_(e,a,s,i);return l.attr("style",t.style),v(t,l),t.intersect=function(c){return k.polygon(t,i,c)},e},"trapezoid"),Nt=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=[{x:s/6,y:0},{x:a-s/6,y:0},{x:a+2*s/6,y:-s},{x:-2*s/6,y:-s}],l=_(e,a,s,i);return l.attr("style",t.style),v(t,l),t.intersect=function(c){return k.polygon(t,i,c)},e},"inv_trapezoid"),_t=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=[{x:0,y:0},{x:a+s/2,y:0},{x:a,y:-s/2},{x:a+s/2,y:-s},{x:0,y:-s}],l=_(e,a,s,i);return l.attr("style",t.style),v(t,l),t.intersect=function(c){return k.polygon(t,i,c)},e},"rect_right_inv_arrow"),Wt=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=a/2,i=s/(2.5+a/50),l=n.height+i+t.padding,c="M 0,"+i+" a "+s+","+i+" 0,0,0 "+a+" 0 a "+s+","+i+" 0,0,0 "+-a+" 0 l 0,"+l+" a "+s+","+i+" 0,0,0 "+a+" 0 l 0,"+-l,o=e.attr("label-offset-y",i).insert("path",":first-child").attr("style",t.style).attr("d",c).attr("transform","translate("+-a/2+","+-(l/2+i)+")");return v(t,o),t.intersect=function(h){const f=k.rect(t,h),x=f.x-t.x;if(s!=0&&(Math.abs(x)<t.width/2||Math.abs(x)==t.width/2&&Math.abs(f.y-t.y)>t.height/2-i)){let p=i*i*(1-x*x/(s*s));p!=0&&(p=Math.sqrt(p)),p=i-p,h.y-t.y>0&&(p=-p),f.y+=p}return f},e},"cylinder"),Xt=d(async(r,t)=>{const{shapeSvg:e,bbox:n,halfPadding:a}=await M(r,t,"node "+t.classes,!0),s=e.insert("rect",":first-child"),i=n.width+t.padding,l=n.height+t.padding;if(s.attr("class","basic label-container").attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("x",-n.width/2-a).attr("y",-n.height/2-a).attr("width",i).attr("height",l),t.props){const c=new Set(Object.keys(t.props));t.props.borders&&(at(s,t.props.borders,i,l),c.delete("borders")),c.forEach(o=>{g.warn(`Unknown node property ${o}`)})}return v(t,s),t.intersect=function(c){return k.rect(t,c)},e},"rect"),Yt=d(async(r,t)=>{const{shapeSvg:e}=await M(r,t,"label",!0);g.trace("Classes = ",t.classes);const n=e.insert("rect",":first-child"),a=0,s=0;if(n.attr("width",a).attr("height",s),e.attr("class","label edgeLabel"),t.props){const i=new Set(Object.keys(t.props));t.props.borders&&(at(n,t.props.borders,a,s),i.delete("borders")),i.forEach(l=>{g.warn(`Unknown node property ${l}`)})}return v(t,n),t.intersect=function(i){return k.rect(t,i)},e},"labelRect");function at(r,t,e,n){const a=[],s=d(l=>{a.push(l,0)},"addBorder"),i=d(l=>{a.push(0,l)},"skipBorder");t.includes("t")?(g.debug("add top border"),s(e)):i(e),t.includes("r")?(g.debug("add right border"),s(n)):i(n),t.includes("b")?(g.debug("add bottom border"),s(e)):i(e),t.includes("l")?(g.debug("add left border"),s(n)):i(n),r.attr("stroke-dasharray",a.join(" "))}d(at,"applyNodePropertyBorders");const Ut=d((r,t)=>{let e;t.classes?e="node "+t.classes:e="node default";const n=r.insert("g").attr("class",e).attr("id",t.domId||t.id),a=n.insert("rect",":first-child"),s=n.insert("line"),i=n.insert("g").attr("class","label"),l=t.labelText.flat?t.labelText.flat():t.labelText;let c="";typeof l=="object"?c=l[0]:c=l,g.info("Label text abc79",c,l,typeof l=="object");const o=i.node().appendChild(I(c,t.labelStyle,!0,!0));let h={width:0,height:0};if($(m().flowchart.htmlLabels)){const b=o.children[0],u=E(o);h=b.getBoundingClientRect(),u.attr("width",h.width),u.attr("height",h.height)}g.info("Text 2",l);const f=l.slice(1,l.length);let x=o.getBBox();const p=i.node().appendChild(I(f.join?f.join("<br/>"):f,t.labelStyle,!0,!0));if($(m().flowchart.htmlLabels)){const b=p.children[0],u=E(p);h=b.getBoundingClientRect(),u.attr("width",h.width),u.attr("height",h.height)}const y=t.padding/2;return E(p).attr("transform","translate( "+(h.width>x.width?0:(x.width-h.width)/2)+", "+(x.height+y+5)+")"),E(o).attr("transform","translate( "+(h.width<x.width?0:-(x.width-h.width)/2)+", 0)"),h=i.node().getBBox(),i.attr("transform","translate("+-h.width/2+", "+(-h.height/2-y+3)+")"),a.attr("class","outer title-state").attr("x",-h.width/2-y).attr("y",-h.height/2-y).attr("width",h.width+t.padding).attr("height",h.height+t.padding),s.attr("class","divider").attr("x1",-h.width/2-y).attr("x2",h.width/2+y).attr("y1",-h.height/2-y+x.height+y).attr("y2",-h.height/2-y+x.height+y),v(t,a),t.intersect=function(b){return k.rect(t,b)},n},"rectWithTitle"),At=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.height+t.padding,s=n.width+a/4+t.padding,i=e.insert("rect",":first-child").attr("style",t.style).attr("rx",a/2).attr("ry",a/2).attr("x",-s/2).attr("y",-a/2).attr("width",s).attr("height",a);return v(t,i),t.intersect=function(l){return k.rect(t,l)},e},"stadium"),Dt=d(async(r,t)=>{const{shapeSvg:e,bbox:n,halfPadding:a}=await M(r,t,void 0,!0),s=e.insert("circle",":first-child");return s.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",n.width/2+a).attr("width",n.width+t.padding).attr("height",n.height+t.padding),g.info("Circle main"),v(t,s),t.intersect=function(i){return g.info("Circle intersect",t,n.width/2+a,i),k.circle(t,n.width/2+a,i)},e},"circle"),Ot=d(async(r,t)=>{const{shapeSvg:e,bbox:n,halfPadding:a}=await M(r,t,void 0,!0),s=5,i=e.insert("g",":first-child"),l=i.insert("circle"),c=i.insert("circle");return i.attr("class",t.class),l.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",n.width/2+a+s).attr("width",n.width+t.padding+s*2).attr("height",n.height+t.padding+s*2),c.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",n.width/2+a).attr("width",n.width+t.padding).attr("height",n.height+t.padding),g.info("DoubleCircle main"),v(t,l),t.intersect=function(o){return g.info("DoubleCircle intersect",t,n.width/2+a+s,o),k.circle(t,n.width/2+a+s,o)},e},"doublecircle"),jt=d(async(r,t)=>{const{shapeSvg:e,bbox:n}=await M(r,t,void 0,!0),a=n.width+t.padding,s=n.height+t.padding,i=[{x:0,y:0},{x:a,y:0},{x:a,y:-s},{x:0,y:-s},{x:0,y:0},{x:-8,y:0},{x:a+8,y:0},{x:a+8,y:-s},{x:-8,y:-s},{x:-8,y:0}],l=_(e,a,s,i);return l.attr("style",t.style),v(t,l),t.intersect=function(c){return k.polygon(t,i,c)},e},"subroutine"),zt=d((r,t)=>{const e=r.insert("g").attr("class","node default").attr("id",t.domId||t.id),n=e.insert("circle",":first-child");return n.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),v(t,n),t.intersect=function(a){return k.circle(t,7,a)},e},"start"),G=d((r,t,e)=>{const n=r.insert("g").attr("class","node default").attr("id",t.domId||t.id);let a=70,s=10;e==="LR"&&(a=10,s=70);const i=n.append("rect").attr("x",-1*a/2).attr("y",-1*s/2).attr("width",a).attr("height",s).attr("class","fork-join");return v(t,i),t.height=t.height+t.padding/2,t.width=t.width+t.padding/2,t.intersect=function(l){return k.rect(t,l)},n},"forkJoin"),Zt=d((r,t)=>{const e=r.insert("g").attr("class","node default").attr("id",t.domId||t.id),n=e.insert("circle",":first-child"),a=e.insert("circle",":first-child");return a.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),n.attr("class","state-end").attr("r",5).attr("width",10).attr("height",10),v(t,a),t.intersect=function(s){return k.circle(t,7,s)},e},"end"),Ft=d((r,t)=>{const e=t.padding/2,n=4,a=8;let s;t.classes?s="node "+t.classes:s="node default";const i=r.insert("g").attr("class",s).attr("id",t.domId||t.id),l=i.insert("rect",":first-child"),c=i.insert("line"),o=i.insert("line");let h=0,f=n;const x=i.insert("g").attr("class","label");let p=0;const y=t.classData.annotations&&t.classData.annotations[0],b=t.classData.annotations[0]?"«"+t.classData.annotations[0]+"»":"",u=x.node().appendChild(I(b,t.labelStyle,!0,!0));let w=u.getBBox();if($(m().flowchart.htmlLabels)){const L=u.children[0],S=E(u);w=L.getBoundingClientRect(),S.attr("width",w.width),S.attr("height",w.height)}t.classData.annotations[0]&&(f+=w.height+n,h+=w.width);let H=t.classData.label;t.classData.type!==void 0&&t.classData.type!==""&&(m().flowchart.htmlLabels?H+="&lt;"+t.classData.type+"&gt;":H+="<"+t.classData.type+">");const R=x.node().appendChild(I(H,t.labelStyle,!0,!0));E(R).attr("class","classTitle");let C=R.getBBox();if($(m().flowchart.htmlLabels)){const L=R.children[0],S=E(R);C=L.getBoundingClientRect(),S.attr("width",C.width),S.attr("height",C.height)}f+=C.height+n,C.width>h&&(h=C.width);const W=[];t.classData.members.forEach(L=>{const S=V(L);let X=S.displayText;m().flowchart.htmlLabels&&(X=X.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const N=x.node().appendChild(I(X,S.cssStyle?S.cssStyle:t.labelStyle,!0,!0));let T=N.getBBox();if($(m().flowchart.htmlLabels)){const j=N.children[0],U=E(N);T=j.getBoundingClientRect(),U.attr("width",T.width),U.attr("height",T.height)}T.width>h&&(h=T.width),f+=T.height+n,W.push(N)}),f+=a;const Z=[];if(t.classData.methods.forEach(L=>{const S=V(L);let X=S.displayText;m().flowchart.htmlLabels&&(X=X.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const N=x.node().appendChild(I(X,S.cssStyle?S.cssStyle:t.labelStyle,!0,!0));let T=N.getBBox();if($(m().flowchart.htmlLabels)){const j=N.children[0],U=E(N);T=j.getBoundingClientRect(),U.attr("width",T.width),U.attr("height",T.height)}T.width>h&&(h=T.width),f+=T.height+n,Z.push(N)}),f+=a,y){let L=(h-w.width)/2;E(u).attr("transform","translate( "+(-1*h/2+L)+", "+-1*f/2+")"),p=w.height+n}let et=(h-C.width)/2;return E(R).attr("transform","translate( "+(-1*h/2+et)+", "+(-1*f/2+p)+")"),p+=C.height+n,c.attr("class","divider").attr("x1",-h/2-e).attr("x2",h/2+e).attr("y1",-f/2-e+a+p).attr("y2",-f/2-e+a+p),p+=a,W.forEach(L=>{E(L).attr("transform","translate( "+-h/2+", "+(-1*f/2+p+a/2)+")");const S=L==null?void 0:L.getBBox();p+=((S==null?void 0:S.height)??0)+n}),p+=a,o.attr("class","divider").attr("x1",-h/2-e).attr("x2",h/2+e).attr("y1",-f/2-e+a+p).attr("y2",-f/2-e+a+p),p+=a,Z.forEach(L=>{E(L).attr("transform","translate( "+-h/2+", "+(-1*f/2+p)+")");const S=L==null?void 0:L.getBBox();p+=((S==null?void 0:S.height)??0)+n}),l.attr("class","outer title-state").attr("x",-h/2-e).attr("y",-(f/2)-e).attr("width",h+t.padding).attr("height",f+t.padding),v(t,l),t.intersect=function(L){return k.rect(t,L)},i},"class_box"),K={rhombus:q,question:q,rect:Xt,labelRect:Yt,rectWithTitle:Ut,choice:Ct,circle:Dt,doublecircle:Ot,stadium:At,hexagon:Tt,rect_left_inv_arrow:Rt,lean_right:It,lean_left:Ht,trapezoid:$t,inv_trapezoid:Nt,rect_right_inv_arrow:_t,cylinder:Wt,start:zt,end:Zt,note:Mt,subroutine:jt,fork:G,join:G,class_box:Ft};let Y={};const rr=d(async(r,t,e)=>{let n,a;if(t.link){let s;m().securityLevel==="sandbox"?s="_top":t.linkTarget&&(s=t.linkTarget||"_blank"),n=r.insert("svg:a").attr("xlink:href",t.link).attr("target",s),a=await K[t.shape](n,t,e)}else a=await K[t.shape](r,t,e),n=a;return t.tooltip&&a.attr("title",t.tooltip),t.class&&a.attr("class","node default "+t.class),Y[t.id]=n,t.haveCallback&&Y[t.id].attr("class",Y[t.id].attr("class")+" clickable"),n},"insertNode"),ar=d((r,t)=>{Y[t.id]=r},"setNodeElem"),er=d(()=>{Y={}},"clear$1"),sr=d(r=>{const t=Y[r.id];g.trace("Transforming node",r.diff,r,"translate("+(r.x-r.width/2-5)+", "+r.width/2+")");const e=8,n=r.diff||0;return r.clusterNode?t.attr("transform","translate("+(r.x+n-r.width/2)+", "+(r.y-r.height/2-e)+")"):t.attr("transform","translate("+r.x+", "+r.y+")"),n},"positionNode");let O={},B={};const ir=d(()=>{O={},B={}},"clear"),nr=d((r,t)=>{const e=$(m().flowchart.htmlLabels),n=t.labelType==="markdown"?tt(r,t.label,{style:t.labelStyle,useHtmlLabels:e,addSvgBackground:!0}):I(t.label,t.labelStyle);g.info("abc82",t,t.labelType);const a=r.insert("g").attr("class","edgeLabel"),s=a.insert("g").attr("class","label");s.node().appendChild(n);let i=n.getBBox();if(e){const c=n.children[0],o=E(n);i=c.getBoundingClientRect(),o.attr("width",i.width),o.attr("height",i.height)}s.attr("transform","translate("+-i.width/2+", "+-i.height/2+")"),O[t.id]=a,t.width=i.width,t.height=i.height;let l;if(t.startLabelLeft){const c=I(t.startLabelLeft,t.labelStyle),o=r.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");l=h.node().appendChild(c);const f=c.getBBox();h.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"),B[t.id]||(B[t.id]={}),B[t.id].startLeft=o,D(l,t.startLabelLeft)}if(t.startLabelRight){const c=I(t.startLabelRight,t.labelStyle),o=r.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");l=o.node().appendChild(c),h.node().appendChild(c);const f=c.getBBox();h.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"),B[t.id]||(B[t.id]={}),B[t.id].startRight=o,D(l,t.startLabelRight)}if(t.endLabelLeft){const c=I(t.endLabelLeft,t.labelStyle),o=r.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");l=h.node().appendChild(c);const f=c.getBBox();h.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"),o.node().appendChild(c),B[t.id]||(B[t.id]={}),B[t.id].endLeft=o,D(l,t.endLabelLeft)}if(t.endLabelRight){const c=I(t.endLabelRight,t.labelStyle),o=r.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");l=h.node().appendChild(c);const f=c.getBBox();h.attr("transform","translate("+-f.width/2+", "+-f.height/2+")"),o.node().appendChild(c),B[t.id]||(B[t.id]={}),B[t.id].endRight=o,D(l,t.endLabelRight)}return n},"insertEdgeLabel");function D(r,t){m().flowchart.htmlLabels&&r&&(r.style.width=t.length*9+"px",r.style.height="12px")}d(D,"setTerminalWidth");const lr=d((r,t)=>{g.info("Moving label abc78 ",r.id,r.label,O[r.id]);let e=t.updatedPath?t.updatedPath:t.originalPath;if(r.label){const n=O[r.id];let a=r.x,s=r.y;if(e){const i=A.calcLabelPosition(e);g.info("Moving label "+r.label+" from (",a,",",s,") to (",i.x,",",i.y,") abc78"),t.updatedPath&&(a=i.x,s=i.y)}n.attr("transform","translate("+a+", "+s+")")}if(r.startLabelLeft){const n=B[r.id].startLeft;let a=r.x,s=r.y;if(e){const i=A.calcTerminalLabelPosition(r.arrowTypeStart?10:0,"start_left",e);a=i.x,s=i.y}n.attr("transform","translate("+a+", "+s+")")}if(r.startLabelRight){const n=B[r.id].startRight;let a=r.x,s=r.y;if(e){const i=A.calcTerminalLabelPosition(r.arrowTypeStart?10:0,"start_right",e);a=i.x,s=i.y}n.attr("transform","translate("+a+", "+s+")")}if(r.endLabelLeft){const n=B[r.id].endLeft;let a=r.x,s=r.y;if(e){const i=A.calcTerminalLabelPosition(r.arrowTypeEnd?10:0,"end_left",e);a=i.x,s=i.y}n.attr("transform","translate("+a+", "+s+")")}if(r.endLabelRight){const n=B[r.id].endRight;let a=r.x,s=r.y;if(e){const i=A.calcTerminalLabelPosition(r.arrowTypeEnd?10:0,"end_right",e);a=i.x,s=i.y}n.attr("transform","translate("+a+", "+s+")")}},"positionEdgeLabel"),Qt=d((r,t)=>{const e=r.x,n=r.y,a=Math.abs(t.x-e),s=Math.abs(t.y-n),i=r.width/2,l=r.height/2;return a>=i||s>=l},"outsideNode"),Vt=d((r,t,e)=>{g.warn(`intersection calc abc89:
  outsidePoint: ${JSON.stringify(t)}
  insidePoint : ${JSON.stringify(e)}
  node        : x:${r.x} y:${r.y} w:${r.width} h:${r.height}`);const n=r.x,a=r.y,s=Math.abs(n-e.x),i=r.width/2;let l=e.x<t.x?i-s:i+s;const c=r.height/2,o=Math.abs(t.y-e.y),h=Math.abs(t.x-e.x);if(Math.abs(a-t.y)*i>Math.abs(n-t.x)*c){let f=e.y<t.y?t.y-c-a:a-c-t.y;l=h*f/o;const x={x:e.x<t.x?e.x+l:e.x-h+l,y:e.y<t.y?e.y+o-f:e.y-o+f};return l===0&&(x.x=t.x,x.y=t.y),h===0&&(x.x=t.x),o===0&&(x.y=t.y),g.warn(`abc89 topp/bott calc, Q ${o}, q ${f}, R ${h}, r ${l}`,x),x}else{e.x<t.x?l=t.x-i-n:l=n-i-t.x;let f=o*l/h,x=e.x<t.x?e.x+h-l:e.x-h+l,p=e.y<t.y?e.y+f:e.y-f;return g.warn(`sides calc abc89, Q ${o}, q ${f}, R ${h}, r ${l}`,{_x:x,_y:p}),l===0&&(x=t.x,p=t.y),h===0&&(x=t.x),o===0&&(p=t.y),{x,y:p}}},"intersection"),P=d((r,t)=>{g.warn("abc88 cutPathAtIntersect",r,t);let e=[],n=r[0],a=!1;return r.forEach(s=>{if(g.info("abc88 checking point",s,t),!Qt(t,s)&&!a){const i=Vt(t,n,s);g.warn("abc88 inside",s,n,i),g.warn("abc88 intersection",i);let l=!1;e.forEach(c=>{l=l||c.x===i.x&&c.y===i.y}),e.some(c=>c.x===i.x&&c.y===i.y)?g.warn("abc88 no intersect",i,e):e.push(i),a=!0}else g.warn("abc88 outside",s,n),n=s,a||e.push(s)}),g.warn("abc88 returning points",e),e},"cutPathAtIntersect"),cr=d(function(r,t,e,n,a,s){let i=e.points,l=!1;const c=s.node(t.v);var o=s.node(t.w);g.info("abc88 InsertEdge: ",e),o.intersect&&c.intersect&&(i=i.slice(1,e.points.length-1),i.unshift(c.intersect(i[0])),g.info("Last point",i[i.length-1],o,o.intersect(i[i.length-1])),i.push(o.intersect(i[i.length-1]))),e.toCluster&&(g.info("to cluster abc88",n[e.toCluster]),i=P(e.points,n[e.toCluster].node),l=!0),e.fromCluster&&(g.info("from cluster abc88",n[e.fromCluster]),i=P(i.reverse(),n[e.fromCluster].node).reverse(),l=!0);const h=i.filter(w=>!Number.isNaN(w.y));let f;a==="graph"||a==="flowchart"?f=e.curve||Q:f=Q;const x=it().x(function(w){return w.x}).y(function(w){return w.y}).curve(f);let p;switch(e.thickness){case"normal":p="edge-thickness-normal";break;case"thick":p="edge-thickness-thick";break;case"invisible":p="edge-thickness-thick";break;default:p=""}switch(e.pattern){case"solid":p+=" edge-pattern-solid";break;case"dotted":p+=" edge-pattern-dotted";break;case"dashed":p+=" edge-pattern-dashed";break}const y=r.append("path").attr("d",x(h)).attr("id",e.id).attr("class"," "+p+(e.classes?" "+e.classes:"")).attr("style",e.style);let b="";switch((m().flowchart.arrowMarkerAbsolute||m().state.arrowMarkerAbsolute)&&(b=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,b=b.replace(/\(/g,"\\("),b=b.replace(/\)/g,"\\)")),g.info("arrowTypeStart",e.arrowTypeStart),g.info("arrowTypeEnd",e.arrowTypeEnd),e.arrowTypeStart){case"arrow_cross":y.attr("marker-start","url("+b+"#"+a+"-crossStart)");break;case"arrow_point":y.attr("marker-start","url("+b+"#"+a+"-pointStart)");break;case"arrow_barb":y.attr("marker-start","url("+b+"#"+a+"-barbStart)");break;case"arrow_circle":y.attr("marker-start","url("+b+"#"+a+"-circleStart)");break;case"aggregation":y.attr("marker-start","url("+b+"#"+a+"-aggregationStart)");break;case"extension":y.attr("marker-start","url("+b+"#"+a+"-extensionStart)");break;case"composition":y.attr("marker-start","url("+b+"#"+a+"-compositionStart)");break;case"dependency":y.attr("marker-start","url("+b+"#"+a+"-dependencyStart)");break;case"lollipop":y.attr("marker-start","url("+b+"#"+a+"-lollipopStart)");break}switch(e.arrowTypeEnd){case"arrow_cross":y.attr("marker-end","url("+b+"#"+a+"-crossEnd)");break;case"arrow_point":y.attr("marker-end","url("+b+"#"+a+"-pointEnd)");break;case"arrow_barb":y.attr("marker-end","url("+b+"#"+a+"-barbEnd)");break;case"arrow_circle":y.attr("marker-end","url("+b+"#"+a+"-circleEnd)");break;case"aggregation":y.attr("marker-end","url("+b+"#"+a+"-aggregationEnd)");break;case"extension":y.attr("marker-end","url("+b+"#"+a+"-extensionEnd)");break;case"composition":y.attr("marker-end","url("+b+"#"+a+"-compositionEnd)");break;case"dependency":y.attr("marker-end","url("+b+"#"+a+"-dependencyEnd)");break;case"lollipop":y.attr("marker-end","url("+b+"#"+a+"-lollipopEnd)");break}let u={};return l&&(u.updatedPath=i),u.originalPath=e.points,u},"insertEdge");export{rr as a,nr as b,cr as c,lr as d,er as e,ir as f,I as g,Bt as h,tr as i,M as l,sr as p,ar as s,v as u};
//# sourceMappingURL=edges-b00f0ec2-afddb99d.js.map
